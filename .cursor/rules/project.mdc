---
description: R√®gles sp√©cifiques au projet Mini CRM Angular 20
globs: ['**/*.ts', '**/*.html', '**/*.scss']
alwaysApply: true
---

# R√®gles sp√©cifiques au projet Mini CRM

Ce projet utilise le MCP Angular pour les best practices Angular 20.
Ces r√®gles compl√®tent le MCP avec les sp√©cificit√©s du projet.

## Stack technique

- **Angular** : 20 (utiliser le MCP Angular pour les best practices)
- **CSS Framework** : Bootstrap 5.3+ (CSS only, pas de JS sauf pour modals)
- **Ic√¥nes** : Bootstrap Icons
- **Styles** : SCSS obligatoire avec variables CSS custom
- **API** : json-server 0.17.4 + json-server-auth 2.1.0
- **Tests** : Vitest (d√©faut Angular 20)

### Versions exactes des d√©pendances API

```bash
npm install json-server@0.17.4 --save-dev
npm install json-server-auth@2.1.0 --save-dev
npm install @types/bootstrap --save-dev
```

### Scripts package.json

```json
{
  "scripts": {
    "ng": "ng",
    "start": "nx serve mini-crm",
    "build": "nx build mini-crm",
    "watch": "nx build mini-crm --watch --configuration development",
    "test": "nx test mini-crm",
    "test:watch": "nx test mini-crm --watch",
    "test:coverage": "nx test mini-crm --coverage",
    "lint": "nx lint mini-crm",
    "server": "json-server --watch db.json --port 3000",
    "server:auth": "json-server-auth db.json --port 3000",
    "dev": "concurrently \"npm start\" \"npm run server\"",
    "graph": "nx graph",
    "graph:app": "nx graph --focus=mini-crm",
    "graph:affected": "nx graph --affected",
    "graph:ui": "nx graph --focus=shared-ui",
    "graph:data": "nx graph --focus=data-access",
    "graph:feature-auth": "nx graph --focus=feature-auth",
    "graph:feature-orders": "nx graph --focus=feature-orders",
    "graph:layout": "nx graph --focus=layout",
    "graph:libs": "nx graph --exclude=mini-crm",
    "graph:show": "nx show project mini-crm --web",
    "docs": "compodoc -p apps/mini-crm/tsconfig.app.json -s --port 8080",
    "docs:build": "compodoc -p apps/mini-crm/tsconfig.app.json -d docs/compodoc",
    "docs:coverage": "compodoc -p apps/mini-crm/tsconfig.app.json --coverageTest 80",
    "docs:watch": "compodoc -p apps/mini-crm/tsconfig.app.json -s --watch"
  }
}
```

## Conventions Angular 20

### Components

```typescript
@Component({
  selector: 'lib-example', // Pr√©fixe "app" pour composants dans apps/, "lib" OBLIGATOIRE pour composants dans libs/
  standalone: true,
  imports: [],
  templateUrl: './example.component.html', // Fichier s√©par√© obligatoire pour components > 20 lignes
  styleUrl: './example.component.scss', // TOUJOURS fichier SCSS s√©par√©
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class ExampleComponent {
  // Services avec inject()
  private readonly service = inject(MyService);

  // Inputs/Outputs avec fonctions
  data = input<Data>();
  dataChange = output<Data>();

  // √âtat avec signals
  items = signal<Item[]>([]);
  loading = signal(false);

  // Valeurs d√©riv√©es avec computed
  count = computed(() => this.items().length);
}
```

### Templates

**R√®gle claire** :

- **Templates inline** : Accept√©s UNIQUEMENT pour components < 20 lignes de template
- **Fichiers .html s√©par√©s** : OBLIGATOIRES pour components ‚â• 20 lignes
- **TOUJOURS** : Fichier SCSS s√©par√©, m√™me pour petit component avec template inline

Exemple template inline (petit component) :

```typescript
@Component({
  template: `
    <div class="spinner-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Chargement...</span>
      </div>
    </div>
  `,
  styleUrl: './spinner.component.scss',  // ‚Üê TOUJOURS fichier SCSS m√™me pour petit component
  changeDetection: ChangeDetectionStrategy.OnPush
})
```

Exemple fichier s√©par√© (component ‚â• 20 lignes) :

```typescript
@Component({
  templateUrl: './order-list.component.html',  // ‚Üê Fichier s√©par√© obligatoire
  styleUrl: './order-list.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush
})
```

### R√®gles obligatoires

- `changeDetection: ChangeDetectionStrategy.OnPush` sur tous les components
- `inject()` pour les d√©pendances (jamais constructor injection)
- `input()` / `output()` (jamais d√©corateurs @Input/@Output)
- `signal()`, `computed()`, `linkedSignal()` pour l'√©tat
- `@if`, `@for`, `@switch` dans les templates (jamais *ngIf, *ngFor)
- `[class]` pour les classes conditionnelles (jamais ngClass)
- Jamais `[ngStyle]` - utiliser classes CSS

## Styles SCSS - R√®gles STRICTES

### ‚ùå INTERDIT

```typescript
// ‚ùå JAMAIS de styles inline dans @Component
@Component({
  styles: [`...`]  // INTERDIT
})

// ‚ùå JAMAIS de style inline dans HTML
<div style="color: red">  // INTERDIT

// ‚ùå JAMAIS de binding style
<div [style.color]="color">  // INTERDIT

// ‚ùå JAMAIS de ngStyle
<div [ngStyle]="{...}">  // INTERDIT
```

### ‚úÖ OBLIGATOIRE

```typescript
// ‚úÖ TOUJOURS fichier SCSS s√©par√©
@Component({
  styleUrl: './component.component.scss'
})
```

## Variables CSS - Approche privil√©gi√©e

### Principe : Variables CSS custom partout

On privil√©gie les **variables CSS custom** (`--xxx`) pour :

- Meilleure maintenabilit√©
- Theming possible par le parent
- Runtime modifiable (contrairement aux variables SCSS)

### Structure d'un fichier SCSS

```scss
// ============================================
// 1. VARIABLES CSS CUSTOM DU COMPONENT
// ============================================
// IMPORTANT : Bootstrap est d√©j√† charg√© globalement dans project.json
// Utiliser directement les variables CSS Bootstrap (var(--bs-primary), etc.)
:host {
  // Variables de layout
  --component-padding: 1rem;
  --component-gap: 0.5rem;

  // Variables de couleurs (utilisent les variables CSS Bootstrap globales)
  --component-bg: var(--bs-light);
  --component-text: var(--bs-dark);
  --component-border: var(--bs-border-color);
  --component-accent: var(--bs-primary);

  // Variables de taille
  --component-width: 250px;
  --component-radius: var(--bs-border-radius);

  // Host display
  display: block;
}

// ============================================
// 3. STYLES DU COMPONENT (utilisent les variables CSS)
// ============================================
.container {
  padding: var(--component-padding);
  background-color: var(--component-bg);
  color: var(--component-text);
  border: 1px solid var(--component-border);
  border-radius: var(--component-radius);
  gap: var(--component-gap);
}

.accent {
  color: var(--component-accent);
}

// ============================================
// 4. √âTATS ET VARIANTES
// ============================================
.container--loading {
  opacity: 0.6;
  pointer-events: none;
}

// ============================================
// 5. RESPONSIVE (si n√©cessaire)
// ============================================
@media (max-width: 768px) {
  :host {
    --component-padding: 0.5rem;
    --component-width: 100%;
  }
}
```

### Avantages des variables CSS

```scss
// Le parent peut surcharger les variables
:host-context(.dark-theme) {
  --component-bg: var(--bs-dark);
  --component-text: var(--bs-light);
}

// Ou le parent via CSS
.dark-theme app-sidebar {
  --component-bg: #1a1a1a;
}
```

### Variables CSS courantes √† d√©finir

| Variable              | Usage                | Valeur Bootstrap typique                   |
| --------------------- | -------------------- | ------------------------------------------ |
| `--component-bg`      | Fond du component    | `var(--bs-white)`, `var(--bs-light)`       |
| `--component-text`    | Couleur texte        | `var(--bs-body-color)`, `var(--bs-dark)`   |
| `--component-border`  | Bordures             | `var(--bs-border-color)`                   |
| `--component-accent`  | Couleur d'accent     | `var(--bs-primary)`                        |
| `--component-padding` | Padding interne      | `1rem` (ou classes Bootstrap `p-3`, `p-4`) |
| `--component-gap`     | Espacement flex/grid | `0.5rem` (ou classes Bootstrap `gap-2`)    |
| `--component-radius`  | Border radius        | `var(--bs-border-radius)`                  |

### Variables CSS Bootstrap disponibles (d√©j√† charg√©es globalement)

Couleurs :

- `var(--bs-primary)`, `var(--bs-secondary)`, `var(--bs-success)`, `var(--bs-danger)`, `var(--bs-warning)`, `var(--bs-info)`, `var(--bs-light)`, `var(--bs-dark)`
- `var(--bs-body-color)`, `var(--bs-body-bg)`, `var(--bs-border-color)`

Espacements :

- Classes utilitaires Bootstrap : `mb-3`, `p-4`, `gap-2`, etc.

Bordures :

- `var(--bs-border-radius)`, `var(--bs-border-radius-sm)`, `var(--bs-border-radius-lg)`

**Note** : Ne pas importer Bootstrap dans les fichiers SCSS individuels. Utiliser directement les variables CSS Bootstrap avec `var(--bs-*)`.

## Hi√©rarchie des styles (priorit√©)

1. **Classes utilitaires Bootstrap** : `mb-3`, `d-flex`, `text-center`, `gap-2`
2. **Composants Bootstrap** : `.card`, `.table`, `.alert`, `.btn`
3. **Variables CSS custom** dans fichier SCSS du component
4. **Styles custom** utilisant les variables CSS

```html
<!-- ‚úÖ BON : Utilitaires Bootstrap + classes custom -->
<div class="d-flex gap-3 mb-4">
  <div class="card custom-card">
    <!-- contenu -->
  </div>
</div>
```

```scss
// custom-card utilise des variables CSS
.custom-card {
  background: var(--card-bg);
  border-color: var(--card-border);
}
```

## Bootstrap 5 - Composants √† utiliser

### Layout

- `.container`, `.container-fluid`
- `.row`, `.col-*`
- `.d-flex`, `.d-grid`, `.gap-*`

### Composants UI

- **Cards** : `.card`, `.card-header`, `.card-body`, `.card-footer`
- **Tables** : `.table`, `.table-striped`, `.table-hover`
- **Alerts** : `.alert`, `.alert-success`, `.alert-danger`, `.alert-warning`, `.alert-info`
- **Modals** : `.modal`, `.modal-dialog`, `.modal-content`
- **Spinner** : `.spinner-border`, `.text-primary`
- **Forms** : `.form-control`, `.form-label`, `.is-invalid`, `.invalid-feedback`
- **Buttons** : `.btn`, `.btn-primary`, `.btn-outline-*`, `.btn-sm`
- **Badges** : `.badge`, `.bg-success`, `.bg-warning`

### Bootstrap Icons (pr√©fixe bi-)

- Navigation : `bi-list-ul`, `bi-house`, `bi-gear`
- Actions : `bi-plus-lg`, `bi-pencil`, `bi-trash`, `bi-check`, `bi-x`
- Auth : `bi-box-arrow-in-right`, `bi-person-plus`, `bi-box-arrow-right`
- App : `bi-briefcase-fill`

## API json-server

### Configuration

- **URL de base** : `http://localhost:3000`
- **json-server** : 0.17.4 (version stable, pas beta)
- **json-server-auth** : 2.1.0

### Endpoints

| M√©thode | Endpoint      | Description                    |
| ------- | ------------- | ------------------------------ |
| GET     | `/orders`     | Liste des commandes            |
| GET     | `/orders/:id` | Une commande                   |
| POST    | `/orders`     | Cr√©er commande                 |
| PUT     | `/orders/:id` | Modifier commande              |
| DELETE  | `/orders/:id` | Supprimer commande             |
| POST    | `/register`   | Inscription (json-server-auth) |
| POST    | `/login`      | Connexion (json-server-auth)   |

### Body pour auth

```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

## Conventions de nommage

| Type          | Convention                | Exemple                                        |
| ------------- | ------------------------- | ---------------------------------------------- |
| Components    | kebab-case.component.ts   | `order-list.component.ts`                      |
| Services      | kebab-case.service.ts     | `orders.service.ts`                            |
| Models        | kebab-case.model.ts       | `order.model.ts`                               |
| Guards        | kebab-case.guard.ts       | `auth.guard.ts`                                |
| Interceptors  | kebab-case.interceptor.ts | `auth.interceptor.ts`                          |
| Routes        | kebab-case.routes.ts      | `orders.routes.ts`                             |
| Variables CSS | --component-property      | `--sidebar-width`                              |
| Libs Nx       | kebab-case                | `shared-ui`, `data-access`, `feature-contacts` |

### Selectors de composants

- **Composants dans `apps/`** : Pr√©fixe `app-` (ex: `app-root`)
- **Composants dans `libs/`** : Pr√©fixe `lib-` OBLIGATOIRE pour TOUS les composants dans toutes les libs (ex: `lib-spinner`, `lib-confirm-modal`, `lib-layout`, `lib-header`, `lib-sidebar`, `lib-sign-in`, `lib-order-list`)
  - **Configuration ESLint** : Tous les fichiers `libs/*/eslint.config.mjs` doivent utiliser `prefix: 'lib'` (pas de `'app'`)
  - **Aucune exception** : M√™me les composants de layout utilis√©s dans `app.component.html` utilisent `lib-`

## Structure Nx - Imports avec alias

### Alias d'import g√©n√©r√©s par Nx

Nx g√©n√®re automatiquement des alias TypeScript dans `tsconfig.base.json` (cr√©√© lors de la g√©n√©ration de libs) :

```typescript
// ‚úÖ Utiliser les alias Nx
import { ButtonComponent } from '@mini-crm/shared-ui';
import { ContactsService } from '@mini-crm/data-access';
import { ContactListComponent } from '@mini-crm/feature-contacts';

// ‚ùå √âviter les imports relatifs entre libs
// import { ButtonComponent } from '../../../libs/shared-ui/src/lib/button.component';
```

### Cr√©er une nouvelle lib Nx

```bash
# Lib UI partag√©e
npx nx g @nx/angular:library libs/shared-ui --unitTestRunner=vitest

# Lib data-access
npx nx g @nx/angular:library libs/data-access --unitTestRunner=vitest

# Lib feature
npx nx g @nx/angular:library libs/feature-contacts --unitTestRunner=vitest
```

Nx g√©n√®re automatiquement :

- L'alias TypeScript (`@mini-crm/shared-ui`)
- Le `project.json` avec les targets (build, test, lint)
- La structure de dossiers standard

## MCP Angular

Avant de cr√©er un component ou service, utiliser le MCP Angular :

```
get_best_practices("component creation")
get_best_practices("service patterns")
get_best_practices("signals")
search_documentation("error message")
```

## Checklist nouveau component

1. [ ] Utiliser MCP Angular (get_best_practices)
2. [ ] Cr√©er dans la bonne lib Nx (`shared-ui`, `data-access`, `feature-*`)
3. [ ] `standalone: true`
4. [ ] `changeDetection: ChangeDetectionStrategy.OnPush`
5. [ ] `inject()` pour les services
6. [ ] `input()` / `output()` pour communication
7. [ ] `signal()` / `computed()` pour l'√©tat
8. [ ] Template : `@if`, `@for` avec `track`
9. [ ] Fichier SCSS s√©par√© (jamais styles inline)
10. [ ] Variables CSS custom pour les valeurs du component
11. [ ] Classes Bootstrap en priorit√©
12. [ ] Imports avec alias Nx (`@mini-crm/...`)

## Commentaires et Documentation (JSDoc/TSDoc + Compodoc)

### Philosophie

- ‚úÖ Privil√©gier un code **auto-document√©** (noms explicites, types clairs)
- ‚úÖ Commenter **le pourquoi**, pas **le quoi**
- ‚úÖ Documenter **l'API publique** pour Compodoc
- ‚ùå √âviter les commentaires redondants

### Outils

- **Compodoc** : Documentation automatique Angular (`npm run docs`)
- **TypeDoc** : Documentation TypeScript g√©n√©rique
- **ESLint** : Validation JSDoc avec r√®gles `jsdoc/*`

### Quand Documenter (OBLIGATOIRE)

#### 1. Services Publics (`data-access/`)

````typescript
/**
 * Service for managing orders data and operations.
 *
 * Handles all HTTP requests related to orders including CRUD operations.
 *
 * @usageNotes
 * Inject this service in components or other services:
 * ```typescript
 * private ordersService = inject(OrdersService);
 * ```
 *
 * @see Order
 * @category Data Access
 */
@Injectable({ providedIn: 'root' })
export class OrdersService {
  /**
   * Retrieves all orders from the API.
   *
   * @returns Observable of orders array
   * @throws {HttpErrorResponse} When API request fails
   *
   * @example
   * ```typescript
   * this.ordersService.getOrders().subscribe({
   *   next: (orders) => console.log(orders)
   * });
   * ```
   */
  getOrders(): Observable<Order[]> {
    return this.http.get<Order[]>(`${API_URL}/orders`);
  }
}
````

#### 2. Composants R√©utilisables (`shared-ui/`)

````typescript
/**
 * Spinner component for loading states.
 *
 * Displays a Bootstrap spinner with customizable size and color.
 *
 * @usageNotes
 * ### Basic Usage
 * ```html
 * <lib-spinner />
 * ```
 *
 * @see SkeletonComponent
 * @category Shared UI
 */
@Component({
  selector: 'lib-spinner',
  changeDetection: ChangeDetectionStrategy.OnPush,
})
export class SpinnerComponent {
  /**
   * Size of the spinner
   * @default 'md'
   */
  size = input<'sm' | 'md' | 'lg'>('md');

  /**
   * Color variant using Bootstrap colors
   * @default 'primary'
   */
  variant = input<'primary' | 'secondary'>('primary');
}
````

#### 3. Signals et State Management

```typescript
/**
 * Current loading state
 * @internal - Not exposed in public API
 */
private loading = signal(false);

/**
 * List of orders
 * @readonly - Use methods to modify
 */
orders = signal<Order[]>([]);

/**
 * Total number of orders
 * @computed
 */
totalOrders = computed(() => this.orders().length);

/**
 * Selected order, linked to orders list
 * @linkedSignal
 */
selectedOrder = linkedSignal(() => this.orders()[0]);
```

#### 4. Guards, Interceptors, Validators

````typescript
/**
 * Authentication guard to protect routes.
 *
 * Redirects to login page if user is not authenticated.
 *
 * @usageNotes
 * Apply to routes in routing configuration:
 * ```typescript
 * {
 *   path: 'orders',
 *   canActivate: [authGuard]
 * }
 * ```
 *
 * @see AuthService
 * @category Security
 */
export const authGuard: CanActivateFn = (route, state) => {
  // Implementation
};
````

#### 5. Models et Interfaces

```typescript
/**
 * Represents an order in the system.
 *
 * @category Models
 * @see OrdersService
 */
export interface Order {
  /**
   * Unique identifier
   * @format uuid
   */
  id: string;

  /**
   * Order title/name
   * @minLength 3
   * @maxLength 100
   */
  title: string;

  /**
   * Order amount in euros
   * @minimum 0
   */
  amount: number;

  /**
   * Current order status
   * @default 'pending'
   */
  status: OrderStatus;
}

/**
 * Order status enumeration
 * @category Models
 */
export enum OrderStatus {
  /** Order is awaiting processing */
  Pending = 'pending',
  /** Order has been confirmed */
  Confirmed = 'confirmed',
}
```

### Documentation des Inputs/Outputs

```typescript
/**
 * User data to display in the card
 * @required
 */
user = input.required<User>();

/**
 * Optional CSS classes to apply
 */
customClass = input<string>('');

/**
 * Emitted when user clicks the edit button
 * @event
 * @param user - The edited user data
 */
userEdited = output<User>();
```

### Quand NE PAS Commenter

- ‚ùå Getters/Setters simples sans logique
- ‚ùå Tests unitaires simples (le `it()` suffit)
- ‚ùå Code √©vident (ex: `this.loading.set(true)`)
- ‚ùå Variables priv√©es internes triviales
- ‚ùå M√©thodes priv√©es simples (sauf logique complexe)

### Tags Compodoc Essentiels

| Tag           | Usage                 | Exemple                        |
| ------------- | --------------------- | ------------------------------ |
| `@usageNotes` | Comment utiliser      | Exemples d'usage               |
| `@see`        | R√©f√©rences crois√©es   | `@see OrdersService`           |
| `@category`   | Cat√©gorie Compodoc    | Data Access, UI, Feature       |
| `@throws`     | Erreurs possibles     | `@throws {HttpErrorResponse}`  |
| `@deprecated` | Code obsol√®te         | Migration vers nouvelle API    |
| `@example`    | Exemples de code      | Blocs de code illustratifs     |
| `@default`    | Valeur par d√©faut     | `@default 'primary'`           |
| `@param`      | Description param√®tre | `@param user - User data`      |
| `@returns`    | Valeur de retour      | `@returns Observable<Order[]>` |
| `@internal`   | API interne           | Ne pas utiliser                |
| `@readonly`   | Lecture seule         | Signal en lecture seule        |
| `@computed`   | Signal computed       | Valeur d√©riv√©e                 |
| `@event`      | Output/EventEmitter   | √âv√©nement √©mis                 |

### Tags Avanc√©s (Optionnels)

```typescript
/**
 * @since 2.0.0
 * @version 2.1.0
 * @alpha  // ou @beta, @experimental
 * @public     // Expos√© dans l'API (d√©faut)
 * @protected  // H√©ritage uniquement
 * @private    // Usage interne
 */
```

### G√©n√©ration de la Documentation

#### Scripts disponibles

```bash
# G√©n√©rer et servir la doc (mode dev)
npm run docs

# Build statique
npm run docs:build

# V√©rifier la couverture
npm run docs:coverage

# Watch mode (recompile automatiquement)
npm run docs:watch
```

#### Configuration

La configuration Compodoc est dans `.compodocrc.json` √† la racine du projet.

### Checklist Documentation

Avant de commit :

- [ ] Services publics document√©s avec JSDoc complet
- [ ] Composants shared-ui avec `@usageNotes` et exemples
- [ ] Tous les inputs/outputs publics document√©s
- [ ] Signals publics avec `@readonly` ou `@computed`
- [ ] Guards/Interceptors avec `@usageNotes`
- [ ] Models/Interfaces avec descriptions des propri√©t√©s
- [ ] Tags `@category` pour organisation Compodoc
- [ ] Tags `@see` pour r√©f√©rences crois√©es
- [ ] Pas de code comment√© mort
- [ ] Coverage Compodoc > 80% (v√©rifier avec `npm run docs:coverage`)

## Bundle Analysis (source-map-explorer)

### Philosophie

- ‚úÖ Analyser le bundle **avant chaque d√©ploiement production**
- ‚úÖ V√©rifier que le budget (500 KB warning, 1 MB error) est respect√©
- ‚úÖ Identifier les opportunit√©s d'optimisation (lazy loading, tree-shaking)
- ‚ùå Ne pas ajouter de d√©pendances lourdes sans justification

### Outil Install√©

**source-map-explorer** : Analyse pr√©cise du bundle de production (esbuild)

```bash
npm install source-map-explorer --save-dev
```

### Configuration

#### Source Maps Activ√©s (project.json)

```json
{
  "configurations": {
    "production": {
      "sourceMap": true,  // ‚Üê OBLIGATOIRE pour l'analyse
      "budgets": [
        {
          "type": "initial",
          "maximumWarning": "500kb",
          "maximumError": "1mb"
        }
      ]
    }
  }
}
```

### Scripts Disponibles

```bash
# Build production avec source maps
npm run build:prod

# Analyser le bundle (g√©n√®re bundle-report.html)
npm run analyze

# Analyser avec tailles gzipp√©es
npm run analyze:gzip

# Export JSON pour CI/CD
npm run analyze:json

# Build + Analyse en une commande
npm run build:analyze
```

### Workflow d'Analyse

#### 1. Build et Analyse

```bash
npm run build:analyze
```

**Output** :
- ‚úÖ Build production dans `dist/apps/mini-crm/browser/`
- ‚úÖ Rapport HTML dans `dist/apps/mini-crm/bundle-report.html`
- ‚úÖ Source maps utilis√©s pour tracer jusqu'au code TypeScript

#### 2. Ouvrir le Rapport

```bash
# Windows
start dist/apps/mini-crm/bundle-report.html

# macOS
open dist/apps/mini-crm/bundle-report.html

# Linux
xdg-open dist/apps/mini-crm/bundle-report.html
```

#### 3. Interpr√©ter le Rapport

**Vue Treemap interactive** :
```
üì¶ Total: 627.51 KB (‚ö†Ô∏è d√©passe budget 500 KB)

Breakdown:
‚îú‚îÄ styles-*.css      : 315.78 KB (50.3%) ‚Üê Bootstrap CSS
‚îú‚îÄ main-*.js         : 196.64 KB (31.3%) ‚Üê Code app + Angular
‚îú‚îÄ scripts-*.js      : 80.46 KB  (12.8%) ‚Üê Bootstrap JS (‚ö†Ô∏è √† retirer ?)
‚îî‚îÄ polyfills-*.js    : 34.63 KB  (5.5%)  ‚Üê Zone.js
```

**Questions √† se poser** :
- ‚ö†Ô∏è Bootstrap JS (80 KB) est-il utilis√© ? ‚Üí Si non, retirer
- ‚ö†Ô∏è Routes lazy-load√©es ? ‚Üí Si non, impl√©menter
- ‚ö†Ô∏è Libs inutilis√©es ? ‚Üí Tree-shaking effectif ?
- ‚ö†Ô∏è Duplications de code ? ‚Üí Imports circulaires ?

### Seuils et Budgets

| Taille Bundle | Statut | Action |
|---------------|--------|--------|
| < 500 KB | ‚úÖ Excellent | Continuer |
| 500-800 KB | ‚ö†Ô∏è Warning | Optimiser si possible |
| > 1 MB | ‚ùå Erreur | **Action requise** |

**Budgets configur√©s** (project.json) :
- **Initial bundle** : 500 KB warning, 1 MB error
- **Component styles** : 4 KB warning, 8 KB error

### Optimisations Courantes

#### 1. Retirer Bootstrap JS Inutilis√©

**Probl√®me** : Bootstrap JS (80 KB) charg√© mais inutilis√©

```json
// apps/mini-crm/project.json
{
  "scripts": ["node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"]
}
```

**Solution** : Retirer si non utilis√©

```json
{
  "scripts": []  // Vide si aucun modal/dropdown Bootstrap
}
```

**Gain** : -80 KB (-13%)

#### 2. Lazy Loading des Routes

**Probl√®me** : Toutes les routes charg√©es au d√©marrage

```typescript
// ‚ùå Eager loading
import { OrdersComponent } from './orders/orders.component';

export const routes = [
  { path: 'orders', component: OrdersComponent }
];
```

**Solution** : Lazy loading

```typescript
// ‚úÖ Lazy loading
export const routes = [
  {
    path: 'orders',
    loadComponent: () => import('./orders/orders.component')
      .then(m => m.OrdersComponent)
  }
];
```

**Gain** : -50 √† -150 KB selon taille du module

#### 3. Tree-Shaking Optimis√©

**Probl√®me** : Import d'une lib enti√®re

```typescript
// ‚ùå Import complet
import * as _ from 'lodash';

// ‚ùå Import barrel
import { debounce } from 'lodash';
```

**Solution** : Import direct

```typescript
// ‚úÖ Import individuel
import debounce from 'lodash-es/debounce';

// ‚úÖ Ou utiliser lodash-es
import { debounce } from 'lodash-es';
```

**Gain** : Variable selon lib

#### 4. Optimiser les Images

**Probl√®me** : Images non optimis√©es

```html
<!-- ‚ùå Image classique -->
<img src="assets/logo.png" alt="Logo">
```

**Solution** : NgOptimizedImage

```typescript
// Importer dans le composant
import { NgOptimizedImage } from '@angular/common';

@Component({
  imports: [NgOptimizedImage]
})
```

```html
<!-- ‚úÖ Image optimis√©e -->
<img ngSrc="assets/logo.png" width="200" height="100" priority alt="Logo">
```

### Checklist Avant Production

Avant chaque d√©ploiement :

```bash
npm run build:analyze
```

- [ ] Bundle total < 500 KB (ou justifier si > 500 KB)
- [ ] Source maps activ√©s en production
- [ ] Bootstrap JS retir√© si non utilis√©
- [ ] Routes principales lazy-load√©es
- [ ] Pas de libs inutilis√©es (v√©rifier treemap)
- [ ] Tree-shaking effectif (imports optimis√©s)
- [ ] Images optimis√©es avec NgOptimizedImage
- [ ] Lighthouse performance > 90

### Int√©gration CI/CD

#### GitHub Actions (exemple)

```yaml
# .github/workflows/ci.yml
- name: Build Production
  run: npm run build:prod

- name: Analyze Bundle
  run: npm run analyze:json

- name: Check Bundle Size
  run: |
    MAIN_SIZE=$(jq '.results[0].totalBytes' dist/apps/mini-crm/bundle-report.json)
    MAX_SIZE=$((1024 * 1024)) # 1MB
    
    if [ $MAIN_SIZE -gt $MAX_SIZE ]; then
      echo "‚ùå Bundle exceeds 1MB!"
      exit 1
    fi
    
    echo "‚úÖ Bundle size OK: $(($MAIN_SIZE / 1024)) KB"

- name: Upload Bundle Report
  uses: actions/upload-artifact@v3
  with:
    name: bundle-report
    path: dist/apps/mini-crm/bundle-report.html
```

### Ressources

- [source-map-explorer Documentation](https://github.com/danvk/source-map-explorer)
- [Angular Performance Guide](https://angular.dev/best-practices/runtime-performance)
- [Web.dev Performance](https://web.dev/performance/)
- [Bundlephobia](https://bundlephobia.com/) - V√©rifier taille des libs avant installation

